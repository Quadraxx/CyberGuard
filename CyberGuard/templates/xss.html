{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <h2 class="text-center mb-4 text-warning">ğŸ•·ï¸ XSS (Cross-Site Scripting) Testi</h2>
        <p class="text-center text-muted">Bir web sitesine "yazÄ±" yerine "kod" yedirebilir misin?</p>

        <!-- Yorum Yapma AlanÄ± -->
        <div class="card p-4 bg-dark border-warning text-white mb-4">
            <h5 class="text-warning">ğŸ“ ZiyaretÃ§i Defteri</h5>
            <div class="mb-3">
                <label class="form-label">MesajÄ±nÄ± BÄ±rak:</label>
                <div class="input-group">
                    <input type="text" id="userComment" class="form-control bg-secondary text-white border-warning" placeholder="Merhaba DÃ¼nya!">
                    <button onclick="postComment()" class="btn btn-warning text-dark fw-bold">GÃ¶nder ğŸš€</button>
                </div>
                <small class="text-muted d-block mt-2">
                    Ä°pucu: <code>&lt;img src=x onerror=alert('HACKED')&gt;</code> yazmayÄ± dene.
                </small>
            </div>
        </div>

        <!-- YorumlarÄ±n ListelendiÄŸi Alan -->
        <div class="card bg-black border-secondary">
            <div class="card-header text-white border-bottom border-secondary">
                Son Yorumlar
            </div>
            <div class="card-body" id="commentsArea">
                <p class="text-muted fst-italic">HenÃ¼z yorum yok...</p>
            </div>
        </div>

        <!-- Bilgi Kutusu -->
        <div class="alert alert-info mt-4">
            <strong>NasÄ±l Ã‡alÄ±ÅŸÄ±r?</strong>
            EÄŸer bir site senin yazdÄ±ÄŸÄ±n girdiyi temizlemeden (sanitize etmeden) ekrana basarsa, tarayÄ±cÄ± bunu yazÄ± deÄŸil, <strong>komut</strong> zanneder. 
        </div>
    </div>
</div>

<script>
    function postComment() {
        let comment = document.getElementById("userComment").value;

        fetch('/api/xss-comment', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ comment: comment })
        })
        .then(res => res.json())
        .then(data => {
            let area = document.getElementById("commentsArea");
            
            // XSS AÃ‡IÄI BURADA!
            // Normalde "innerText" kullanmalÄ±yÄ±z. 
            // Ama biz "innerHTML" kullanarak aÃ§Ä±ÄŸÄ± simÃ¼le ediyoruz.
            // BÃ¶ylece tarayÄ±cÄ± <script> veya <img> etiketlerini Ã§alÄ±ÅŸtÄ±racak.
            
            let newCommentHtml = `
                <div class="p-2 border-bottom border-secondary text-white">
                    <strong>Misafir:</strong> ${data.original_comment}
                </div>
            `;
            
            // EÄŸer ilk yorumsa "HenÃ¼z yorum yok" yazÄ±sÄ±nÄ± sil
            if(area.innerHTML.includes("HenÃ¼z yorum yok")) {
                area.innerHTML = newCommentHtml;
            } else {
                area.innerHTML += newCommentHtml;
            }
        });
    }
</script>
{% endblock %}